# Hyperliquid 지갑 추적 자동화 시스템 기획서

## 1. 목적 및 개요

Hyperliquid 상의 주요 고래 지갑 주소들을 대상으로 **여러 종목의 열린 포지션(Open Position)** 정보를 5분 간격으로 자동 추적하고, 다음의 목적을 달성하는 시스템을 설계한다:

* 🔍 HyperScan에서는 하나씩 지갑을 눌러야 하는 불편함 해소 → **여러 지갑을 한눈에 보는 요약화면 제공**
* 🕵️ 특정 고래 지갑의 **진입 타이밍(신규 포지션 생성 시점)** 을 타이트하게 캐치하고 **Telegram으로 실시간 알림**

이를 위해 Node.js 기반 서버에서 데이터를 주기적으로 수집하고, 이전 상태와 비교한 결과를 기반으로 Google Spreadsheet와 Telegram으로 결과를 전송한다.

---

## 2. 핵심 구조 요약

| 요소     | 구성 설명                              |
| ------ | ---------------------------------- |
| 기록 포맷  | Node.js 서버 + GAS 연동                |
| 데이터 흐름 | Hyperliquid → 서버 → 시트 + Telegram   |
| 추적 대상  | Hyperliquid API: 열린 포지션 정보         |
| 상태 저장  | 서버 로컬 메모리 또는 JSON 파일(`state.json`) |
| 시트 전송  | Google Apps Script (GAS) POST 수신   |
| 알림 전송  | Telegram Bot API                   |
| 주기     | 5분마다 (cron job)                    |

---

## 3. 서버 기반 설계 흐름

### 3.1 전체 흐름

```
[고래 지갑 리스트] → [Hyperliquid API 호출]
        ↓
[서버의 이전 상태와 비교]
        ↓
  ├─ 변경사항 있음 → Telegram 알림 + GAS 로그 시트 append
  └─ 항상 → 전체 상태 시트는 GAS로 덮어쓰기
```

### 3.2 상태 저장 구조 예시

```json
{
  "0xabc123::ETH": { "side": "long", "sz": "1.25", "entry": "2630.5" },
  "0xabc123::BTC": { "side": "short", "sz": "0.5", "entry": "71200" }
}
```

* 변경사항 감지는 `address + coin` 조합을 키로 비교함

---

## 4. Google Sheets 구성

### 4.1 현재 상태 시트 (`현재포지션`)

* 서버에서 5분마다 **전체 덮어쓰기**
* 유저별로 포지션 묶어서 가독성 있게 정렬

| 시간    | 구분 | 이름  | 지갑 주소     | 종목  | 방향   | 수량   | 진입가    | 청산가    | 상태     |
| ----- | -- | --- | --------- | --- | ---- | ---- | ------ | ------ | ------ |
| 06:10 | 주요 | 김태은 | 0x5078... | ETH | Long | 1.25 | 2630.5 | 2450.0 | Active |

### 4.2 변경 이력 시트 (`포지션변경로그`)

* **변경 발생 시에만 append**

| 시간    | 이름  | 주소        | 종목  | 변경유형 | 내용요약                  |
| ----- | --- | --------- | --- | ---- | --------------------- |
| 06:10 | 김태은 | 0x5078... | ETH | 신규진입 | 1.25 ETH 롱 진입 @2630.5 |

---

## 5. Telegram 알림 조건

| 이벤트           | 예시 메시지                  |
| ------------- | ----------------------- |
| ✅ 신규 포지션 생성   | \`📥 ETH 롱 진입           |
| 지갑: 0x5078... |                         |
| 사이즈: 1.25\`   |                         |
| ✅ 포지션 수량 변경   | \`⬆️ BTC 롱 추가 진입 (+0.5) |
| 총: 2.0\`      |                         |
| ✅ 포지션 종료      | `❌ SOL 포지션 종료`          |

---

## 6. 구현 구성 (디렉토리)

```
hyper-position-tracker/
├── public/
│   └── index.html (지갑 등록용)
├── addresses.json (고래 지갑 목록)
├── state.json (이전 포지션 상태 저장)
├── server.js (주소 등록 및 GAS 요청 처리)
├── tracker.js (5분 주기 데이터 수집/전송)
├── utils/
│   ├── fetchOpenPositions.js
│   ├── sendTelegram.js
│   └── sendToGAS.js
└── .env
```

---

## 7. 실행 방식

1. `.env`에 `BOT_TOKEN`, `CHAT_ID`, `GAS_URL` 등 설정
2. `node server.js` 실행 (주소 등록 웹서버)
3. `node tracker.js` 실행 (포지션 수집 및 상태 비교 + 시트 반영)

---

## 8. 결론

* Hyperliquid 지갑들을 다수 추적하여 **한눈에 현황 파악** 가능
* **신규 진입, 포지션 변화, 종료**를 실시간 알림으로 캐치
* 시트와 Telegram을 목적별로 분리 운영하여 **분석과 알림 모두 강화**
* 서버는 **상태 저장소로 동작**, GAS는 단순 기록 장치로 사용

→ 이를 통해 고래 지갑들의 활동을 실시간으로 민감하게 추적하고, 진입 타이밍을 캐치하는 데 최적화된 도구로 활용 가능하다.
